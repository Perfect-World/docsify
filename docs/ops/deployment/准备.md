## 准备

### 插件

```bash
# 检查是否安装
tar --version
curl --version
unzip --version
# 安装
sudo apt install -y tar
sudo apt install -y curl
sudo apt install -y unzip
```

### 端口号

```bash
# 部署端口号设置
# 50001 ～ 50050 前端
# 50051 ～ 50060 后端
# 50061 ～ 50070 数据库
# 50071 ～ 50080 中间件
# 开启端口
firewall-cmd --zone=public --add-port=50001-50100/tcp --permanent 
# 重新载入配置信息而不中断服务
systemctl reload firewalld
# 其它
systemctl list-units --type=service 			# 输出系统中各个服务的状态
systemctl status firewalld 								# 查看服务的运行状态
firewall-cmd --zone=public --list-ports 	# 查看防火墙开放端口
systemctl stop firewalld									# 关闭服务
systemctl start firewalld									# 启动服务
systemctl restart firewalld 							# 重新启动服务（不管当前服务是启动还是关闭）
systemctl reload firewalld							 	# 重新载入配置信息而不中断服务
systemctl disable firewalld 							# 禁止服务开机自启动
systemctl enable firewalld 								# 设置服务开机自启动
```

### 注意

一定要先部署准线上环境，然后部署后面



























### 脚本

```bash
# 压缩
mkdir -p /yykj/deployment/sh
tar -zcf /yykj/deployment/sh.tar.gz -C /yykj/deployment/sh .
# 进入部署服务器
deployment_path="/yykj/deployment"
deployment_url="http://121.237.178.252/yykj_deployment"
curl -fSL --retry 3 --output "${deployment_path}/sh.tar.gz" "${deployment_url}/sh.tar.gz"
mkdir -p /yykj/deployment/sh
tar -zxf /yykj/deployment/sh.tar.gz -C /yykj/deployment/sh
chmod -R 775 /yykj/deployment/sh/*
ls -l /yykj/deployment/sh
sh /yykj/deployment/sh/create_path.sh
sh /yykj/deployment/sh/server_info.sh

curl -fSL --retry 3 --output "/yykj/project/scsmp-java/deploy_scsmp_java.sh" "${deployment_url}/deploy_scsmp_java.sh" 
curl -fSL --retry 3 --output "/yykj/project/scsmp-java/deploy_scsmp_sql.sh" "${deployment_url}/deploy_scsmp_sql.sh" 
curl -fSL --retry 3 --output "/yykj/project/scsmp-vue/deploy_scsmp_vue.sh" "${deployment_url}/deploy_scsmp_vue.sh" 

```


### docker

```bash
tar -zcf /yykj/deployment/docker/docker-29.1.2.tar.gz -C /yykj/deployment/docker/docker .
```


### 镜像文件

##### 存放目录

```bash
docker_images_tar_path="/yykj/deployment/docker-images"
mkdir -p ${docker_images_tar_path}
```

##### 有网服务器，已装docker

```bash
docker_images_tar_path="/yykj/deployment/docker-images"
# 拉取
docker pull mysql:8.2
docker pull openjdk:21-jdk
docker pull nginx:1.22
# 打包
docker save mysql:8.2 -o ${docker_images_tar_path}/mysql_8.2.tar
docker save openjdk:21-jdk -o ${docker_images_tar_path}/jdk_21.tar
docker save nginx:1.22 -o ${docker_images_tar_path}/nginx_1.22.tar
```

##### 本地 mac 打包，梯子，docker软件，终端

```bash
docker_images_tar_path="/Users/wencong/Downloads/临时"
# 拉取
docker pull alpine/git:latest
docker pull maven:3.9.11-amazoncorretto-21-debian
docker pull node:24.12.0-alpine
# 打包
docker save alpine/git:latest -o ${docker_images_tar_path}/git_latest.tar
docker save maven:3.9.11-amazoncorretto-21-debian -o ${docker_images_tar_path}/maven_3.9.11.tar
docker save node:24.12.0-alpine -o ${docker_images_tar_path}/node_24.12.tar
# 上传，从本地到远程
remote_docker_images_tar_path="/yykj/deployment/docker-images"
remote_url="root@121.237.178.252"
scp ${docker_images_tar_path}/git_latest.tar ${remote_url}:${remote_docker_images_tar_path}
scp ${docker_images_tar_path}/maven_3.9.11.tar ${remote_url}:${remote_docker_images_tar_path}
scp ${docker_images_tar_path}/node_24.12.tar ${remote_url}:${remote_docker_images_tar_path}
```

##### 压缩/解压

```bash
# 压缩 -C /yykj/deployment：先切换到该目录，再打包 ./*（当前目录下所有文件）
tar -zcf /yykj/deployment/docker.tar.gz -C /yykj/deployment/docker .
tar -zcf /yykj/deployment/docker-images.tar.gz -C /yykj/deployment/docker-images .
# 进入部署服务器，通过scp下载docker-images.tar.gz 121.237.178.252
curl -fSL --retry 3 --output "${deployment_path}/docker.tar.gz" "${deployment_url}/docker.tar.gz"
curl -fSL --retry 3 --output "${deployment_path}/docker-images.tar.gz" "${deployment_url}/docker-images.tar.gz"
# 解压 
mkdir -p /yykj/environment/docker/docker
mkdir -p /yykj/environment/docker-images
tar -zxf /yykj/deployment/docker.tar.gz -C /yykj/environment/docker
tar -zxf /yykj/deployment/docker-images.tar.gz -C /yykj/environment/docker-images
chmod -R 775 /yykj/environment/docker/*
chmod -R 775 /yykj/environment/docker-images/*
ls -l /yykj/environment/docker
ls -l /yykj/environment/docker-images
```

### git

##### 创建公钥

```bash
# 本地执行命令，生成公钥私钥
id_rsa id_rsa.pub
# 公网服务器121.237.178.252 创建存储目录
mkdir -p /yykj/deployment/git-config
# 上传到公网服务器121.237.178.252
scp ./id_rsa root@121.237.178.252:/yykj/deployment/git-config
scp ./id_rsa.pub root@121.237.178.252:/yykj/deployment/git-config
tar -zcf /yykj/deployment/git-config.tar.gz -C /yykj/deployment/git-config .
# 到git服务器上，添加公钥，并设置只读拉取权限
# 进入部署服务器，通过scp下载id_rsa id_rsa.pub
curl -fSL --retry 3 --output "${deployment_path}/git-config.tar.gz" "${deployment_url}/git-config.tar.gz"
mkdir -p /yykj/environment/git-config/.ssh
tar -zxf /yykj/deployment/git-config.tar.gz -C /yykj/environment/git-config/.ssh
chmod 700 /yykj/environment/git-config/.ssh
chmod 600 /yykj/environment/git-config/.ssh/id_rsa
chmod 644 /yykj/environment/git-config/.ssh/id_rsa.pub
ls -l /yykj/environment/git-config/.ssh
```

### nginx配置文件

```bash
# mime.types  nginx.conf  nginx-cert.crt  nginx-private.key
mkdir -p /yykj/deployment/nginx-config
tar -zcf /yykj/deployment/nginx-config.tar.gz -C /yykj/deployment/nginx-config .
# 进入部署服务器
curl -fSL --retry 3 --output "${deployment_path}/nginx-config.tar.gz" "${deployment_url}/nginx-config.tar.gz"
tar -zxf /yykj/deployment/nginx-config.tar.gz -C /yykj/environment/nginx-config
chmod -R 775 /yykj/environment/nginx-config/*
ls -l /yykj/environment/nginx-config
# 容器node依赖插件配置源
cat > /yykj/environment/node/repositories << 'EOF'
https://mirrors.aliyun.com/alpine/v3.23/main/
https://mirrors.aliyun.com/alpine/v3.23/community/
EOF
# 使用自定义 nginx 配置文件
tar -zxf /yykj/deployment/nginx-config.tar.gz -C /yykj/project/scsmp-vue/conf
tar -zxf /yykj/deployment/nginx-config.tar.gz -C /yykj/project/scsmp-h5/conf
chmod -R 775 /yykj/project/scsmp-vue/conf/*
chmod -R 775 /yykj/project/scsmp-h5/conf/*
```

### mysql配置文件

```bash
# my.cnf
mkdir -p /yykj/deployment/mysql-config
# 进入部署服务器
mkdir -p /yykj/environment/mysql-config
curl -fSL --retry 3 --output "/yykj/environment/mysql-config/conf/my.cnf" "${deployment_url}/mysql-config/my.cnf"
chmod -R 775 /yykj/environment/mysql-config/*
ls -l /yykj/environment/mysql-config
```

### sh

```bash
maven
```


```bash

```